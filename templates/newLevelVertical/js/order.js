if(selectDeliv){var methodDeliv="#method_deliv"}else{var methodDeliv='[name = "deliveryMethodId"]'}function renderOrderDetails(b){$(genObj.orderDetails).html(_.template($(genObj.orderDetailsTemplate).html(),{cart:Shop.Cart}));$(document).trigger({type:"renderorder.after",el:$(genObj.orderDetails)});initShopPage(false);recountCartPage("renderOrderDetails");if(b==="start"&&$.isFunction(window.renderGift)){renderGift(Shop.Cart.gift)}if(b!=="start"){getDiscount("renderOrderDetails")}}function changeDeliveryMethod(a){$(genObj.pM).next().show();$.get("/shop/cart_api/getPaymentsMethods/"+a,function(b){var d=JSON.parse(b),c="";if(selectPayment){c=_.template($("#orderPaymentSelect").html(),{data:d})}else{c=_.template($("#orderPaymentRadio").html(),{data:d})}$(genObj.pM).html(c);$(genObj.pM).next().hide();if(selectPayment){cuselInit($(genObj.pM),"#paymentMethod")}else{$(genObj.pM).nStRadio({wrapper:$(".frame-radio > .frame-label"),elCheckWrap:".niceRadio"})}})}function displayOrderSum(c){var f=Shop.Cart.discount,e=parseFloat(Shop.Cart.kitDiscount),a=Shop.Cart.getFinalAmount();if(Shop.Cart.koefCurr==undefined){var b=parseFloat(Shop.Cart.totalPrice).toFixed(pricePrecision),d=parseFloat(Shop.Cart.totalAddPrice).toFixed(pricePrecision);Shop.Cart.koefCurr=d/b}if(f!=null&&f!=0){a=a-f.result_sum_discount_convert}if(e!=0){a=a-e}a=a>Shop.Cart.shipping?a:Shop.Cart.shipping;$(genObj.totalPrice).html(parseFloat(Shop.Cart.getTotalPriceOrigin()).toFixed(pricePrecision));$(genObj.finalAmount).html(parseFloat(a).toFixed(pricePrecision));$(genObj.finalAmountAdd).html((Shop.Cart.koefCurr*a).toFixed(pricePrecision));$(genObj.shipping).html(parseFloat(Shop.Cart.shipping).toFixed(pricePrecision));if(c!=null){if(parseFloat(c.result_sum_discount_convert)>0){$(genObj.frameGenDiscount).show()}else{$(genObj.frameGenDiscount).hide()}}else{$(genObj.frameGenDiscount).hide()}}function recountCartPage(c){Shop.Cart.totalRecount();var b="";if(selectDeliv){b=$(genObj.frameDelivery).find("span.cuselActive")}else{b=$(methodDeliv).filter(":checked")}Shop.Cart.shipping=parseFloat(b.data("price"));Shop.Cart.shipFreeFrom=parseFloat(b.data("freefrom"));hideInfoDiscount();if(c!=="renderOrderDetails"){getDiscount("recountCartPage")}}function hideInfoDiscount(){var a=$(genObj.frameDiscount);a.empty();a.next(preloader).show()}function displayInfoDiscount(a){var b=$(genObj.frameDiscount);b.html(a);b.next(preloader).hide()}function renderGiftInput(a){if(a==""){$(genObj.gift).empty()}else{$(genObj.gift).html(a)}$("#giftButton").click(function(c){$(genObj.gift).find(preloader).show();var b=0;$.ajax({url:"/mod_discount/gift/get_gift_certificate",data:"key="+$("[name=giftcert]").val(),type:"GET",success:function(d){if(d!=""){b=JSON.parse(d)}$(genObj.gift).find(preloader).hide();Shop.Cart.gift=b;if(b.error){$(document).trigger({type:"discount.giftError",datas:b.mes})}if(!b.error&&$.isFunction(window.loadCertificat)){loadCertificat(Shop.Cart.gift)}}});c.preventDefault()});$("#giftInput").keydown(function(b){if(b.keyCode==13){$("#giftButton").trigger("click");b.preventDefault()}})}function giftError(a){$(genObj.gift).children(genObj.msgF).remove();if(a){$(genObj.gift).append(message.error(a));drawIcons($(genObj.gift).find(selIcons))}}function renderGiftSucces(a,b){$(genObj.certPrice).html(b.value);$(genObj.certFrame).show();$(genObj.gift).children(genObj.msgF).remove();$(genObj.gift).html(a);recountCartPage("renderGiftSucces")}$(document).on("scriptDefer",function(){if(selectDeliv){cuselInit($(genObj.frameDelivery),methodDeliv);$(methodDeliv).on("change.methoddeliv",function(){var a=$(genObj.frameDelivery).find("span.cuselActive").attr("val");changeDeliveryMethod(a);recountCartPage("change.methoddeliv")})}else{$(".check-variant-delivery").nStRadio({wrapper:$(".frame-radio > .frame-label"),elCheckWrap:".niceRadio",before:function(a){$(document).trigger("showActivity");$('[name="'+$(a).find("input").attr("name")+'"]').attr("disabled","disabled")},after:function(b,c){if(!c){var a=b.find("input").val();changeDeliveryMethod(a);recountCartPage("change_delivery");$('[name="'+$(b).find("input").attr("name")+'"]').removeAttr("disabled")}}})}if(selectPayment){cuselInit($(genObj.pM),"#paymentMethod")}else{$(genObj.pM).nStRadio({wrapper:$(".frame-radio > .frame-label"),elCheckWrap:".niceRadio"})}$(document).on("render_popup_cart",function(){});$(document).on("sync_cart",function(){renderOrderDetails()});$(document).on("count_changed",function(){recountCartPage("count_changed")});$(document).on("cart_rm",function(a){recountCartPage("cart_rm")});$(document).on("discount.display",function(a){displayInfoDiscount(a.tpl)});renderOrderDetails("start")});function initOrderTrEv(){$(document).on("discount.renderGiftInput",function(a){renderGiftInput(a.tpl)});$(document).on("discount.giftError",function(a){giftError(a.datas)});$(document).on("discount.renderGiftSucces",function(a){renderGiftSucces(a.tpl,a.datas)});$(document).on("displayDiscount",function(a){displayOrderSum(a.obj)})};